-- æ–‡ä»¶åï¼šAutoServerVulnerabilityScanner_Complete.lua
-- å®Œæ•´å¯è¿è¡Œç‰ˆæœ¬ - æœåŠ¡å™¨æ¼æ´æ‰«æä¸ä¿æŠ¤å·¥å…·
-- ä¿®å¤äº†è¿è¡Œé—®é¢˜ï¼Œç¡®ä¿æœ€å¤§å¸§ç‡åå°ä¿æŠ¤

local Scanner = {}
Scanner.IsRunning = false
Scanner.DetectionEnabled = false
Scanner.DetectedThreats = {}
Scanner.AlertOnly = true
Scanner.RecentCalls = {}
Scanner.HookedRemotes = {}
Scanner.BackgroundMode = false
Scanner.RemoteObjects = {}
Scanner.MaxFrameRate = 60
Scanner.CallStats = {
    totalCalls = 0,
    successfulCalls = 0, 
    failedCalls = 0,
    lastLogTime = tick()
}
Scanner.SecurityLog = {}

-- åˆ›å»ºUIç•Œé¢
function Scanner.createUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "VulnerabilityScannerGUI"
    screenGui.ResetOnSpawn = false
    screenGui.Enabled = true
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "ScannerUI"
    mainFrame.Size = UDim2.new(0, 350, 0, 300)
    mainFrame.Position = UDim2.new(0.5, -175, 0.5, -150)
    mainFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = false
    
    -- æ ‡é¢˜æ 
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 25)
    titleBar.Position = UDim2.new(0, 0, 0, 0)
    titleBar.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = mainFrame
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(1, -30, 1, 0)
    titleLabel.Position = UDim2.new(0, 5, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "ğŸ” æœåŠ¡å™¨æ¼æ´æ‰«æå™¨ v2.0"
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.TextSize = 12
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar
    
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 25, 0, 25)
    closeButton.Position = UDim2.new(1, -25, 0, 0)
    closeButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    closeButton.BorderSizePixel = 0
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.new(1, 1, 1)
    closeButton.TextSize = 14
    closeButton.Parent = titleBar
    
    -- å†…å®¹åŒºåŸŸ
    local contentFrame = Instance.new("Frame")
    contentFrame.Name = "ContentFrame"
    contentFrame.Size = UDim2.new(1, -10, 1, -35)
    contentFrame.Position = UDim2.new(0, 5, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = mainFrame
    
    -- æ‰«ææŒ‰é’®
    local scanButton = Instance.new("TextButton")
    scanButton.Name = "ScanButton"
    scanButton.Size = UDim2.new(1, 0, 0, 30)
    scanButton.Position = UDim2.new(0, 0, 0, 0)
    scanButton.BackgroundColor3 = Color3.new(0.2, 0.6, 0.2)
    scanButton.BorderSizePixel = 0
    scanButton.Text = "å¼€å§‹å•æ¬¡æ‰«ææœåŠ¡å™¨æ¼æ´"
    scanButton.TextColor3 = Color3.new(1, 1, 1)
    scanButton.TextSize = 12
    scanButton.Parent = contentFrame
    
    -- æ— é™å¾ªç¯æ‰«ææŒ‰é’®
    local loopButton = Instance.new("TextButton")
    loopButton.Name = "LoopButton"
    loopButton.Size = UDim2.new(1, 0, 0, 30)
    loopButton.Position = UDim2.new(0, 0, 0, 35)
    loopButton.BackgroundColor3 = Color3.new(0.2, 0.6, 0.8)
    loopButton.BorderSizePixel = 0
    loopButton.Text = "å¯åŠ¨æ— é™å¾ªç¯æ‰«æ"
    loopButton.TextColor3 = Color3.new(1, 1, 1)
    loopButton.TextSize = 12
    loopButton.Parent = contentFrame
    
    -- è¿œç¨‹è°ƒç”¨æ£€æµ‹æŒ‰é’®
    local detectionButton = Instance.new("TextButton")
    detectionButton.Name = "DetectionButton"
    detectionButton.Size = UDim2.new(0.6, 0, 0, 30)
    detectionButton.Position = UDim2.new(0, 0, 0, 70)
    detectionButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    detectionButton.BorderSizePixel = 0
    detectionButton.Text = "ğŸ” å¯åŠ¨è¿œç¨‹è°ƒç”¨æ£€æµ‹"
    detectionButton.TextColor3 = Color3.new(1, 1, 1)
    detectionButton.TextSize = 12
    detectionButton.Parent = contentFrame
    
    -- å¨èƒè®¡æ•°æ˜¾ç¤º
    local threatCountLabel = Instance.new("TextLabel")
    threatCountLabel.Name = "ThreatCount"
    threatCountLabel.Size = UDim2.new(0.35, 0, 0, 30)
    threatCountLabel.Position = UDim2.new(0.65, 0, 0, 70)
    threatCountLabel.BackgroundTransparency = 1
    threatCountLabel.Text = "æ£€æµ‹åˆ°: 0"
    threatCountLabel.TextColor3 = Color3.new(1, 0.8, 0.2)
    threatCountLabel.TextSize = 12
    threatCountLabel.TextXAlignment = Enum.TextXAlignment.Right
    threatCountLabel.Parent = contentFrame
    
    -- åå°ä¿æŠ¤æ¨¡å¼æŒ‰é’®
    local backgroundButton = Instance.new("TextButton")
    backgroundButton.Name = "BackgroundButton"
    backgroundButton.Size = UDim2.new(1, 0, 0, 30)
    backgroundButton.Position = UDim2.new(0, 0, 0, 105)
    backgroundButton.BackgroundColor3 = Color3.new(0.6, 0.4, 0.2)
    backgroundButton.BorderSizePixel = 0
    backgroundButton.Text = "ğŸ”’ å¯ç”¨æœ€å¤§å¸§ç‡åå°ä¿æŠ¤"
    backgroundButton.TextColor3 = Color3.new(1, 1, 1)
    backgroundButton.TextSize = 12
    backgroundButton.Parent = contentFrame
    
    -- ç»“æœæ˜¾ç¤ºåŒºåŸŸ
    local resultsBox = Instance.new("TextLabel")
    resultsBox.Name = "ResultsBox"
    resultsBox.Size = UDim2.new(1, 0, 1, -190)
    resultsBox.Position = UDim2.new(0, 0, 0, 140)
    resultsBox.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
    resultsBox.BorderSizePixel = 0
    resultsBox.Text = "ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ‰«æ..."
    resultsBox.TextColor3 = Color3.new(1, 1, 1)
    resultsBox.TextSize = 10
    resultsBox.TextWrapped = true
    resultsBox.TextXAlignment = Enum.TextXAlignment.Left
    resultsBox.TextYAlignment = Enum.TextYAlignment.Top
    resultsBox.Parent = contentFrame
    
    -- çŠ¶æ€æ ‡ç­¾
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Name = "StatusLabel"
    statusLabel.Size = UDim2.new(1, 0, 0, 15)
    statusLabel.Position = UDim2.new(0, 0, 1, -15)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "å°±ç»ª"
    statusLabel.TextColor3 = Color3.new(1, 1, 1)
    statusLabel.TextSize = 10
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.Parent = contentFrame
    
    -- æ·»åŠ åˆ°CoreGui
    screenGui.Parent = game:GetService("CoreGui")
    mainFrame.Parent = screenGui
    
    -- ä¿å­˜å¼•ç”¨
    Scanner.UI = {
        MainFrame = mainFrame,
        ScreenGui = screenGui,
        ScanButton = scanButton,
        LoopButton = loopButton,
        DetectionButton = detectionButton,
        BackgroundButton = backgroundButton,
        ThreatCountLabel = threatCountLabel,
        ResultsBox = resultsBox,
        StatusLabel = statusLabel,
        CloseButton = closeButton,
        TitleBar = titleBar
    }
    
    return mainFrame
end

-- è®¾ç½®åŠŸèƒ½
function Scanner.setupFunctions()
    -- æ‹–åŠ¨åŠŸèƒ½
    local dragging = false
    local dragStart, startPos
    
    Scanner.UI.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Scanner.UI.MainFrame.Position
        end
    end)
    
    Scanner.UI.TitleBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Scanner.UI.MainFrame.Position = UDim2.new(0, startPos.X.Offset + delta.X, 0, startPos.Y.Offset + delta.Y)
        end
    end)
    
    -- æŒ‰é’®äº‹ä»¶
    Scanner.UI.ScanButton.MouseButton1Click:Connect(function()
        Scanner.startAutoScan()
    end)
    
    Scanner.UI.LoopButton.MouseButton1Click:Connect(function()
        if not Scanner.IsRunning then
            Scanner.startInfiniteLoop()
        else
            Scanner.stopInfiniteLoop()
        end
    end)
    
    Scanner.UI.DetectionButton.MouseButton1Click:Connect(function()
        if not Scanner.DetectionEnabled then
            Scanner.enableRemoteDetection()
        else
            Scanner.disableRemoteDetection()
        end
    end)
    
    Scanner.UI.BackgroundButton.MouseButton1Click:Connect(function()
        if not Scanner.BackgroundMode then
            Scanner.enableBackgroundMode()
        else
            Scanner.disableBackgroundMode()
        end
    end)
    
    Scanner.UI.CloseButton.MouseButton1Click:Connect(function()
        Scanner.closeUI()
    end)
end

-- æ›´æ–°çŠ¶æ€
function Scanner.updateStatus(text)
    if Scanner.UI and Scanner.UI.StatusLabel then
        Scanner.UI.StatusLabel.Text = text
    end
end

-- æ·»åŠ ç»“æœ
function Scanner.addResult(text)
    if not Scanner.UI or not Scanner.UI.ResultsBox then return end
    
    local currentText = Scanner.UI.ResultsBox.Text
    local newText = currentText .. "\n" .. text
    
    if #newText > 1000 then
        newText = string.sub(newText, #newText - 800, #newText)
    end
    
    Scanner.UI.ResultsBox.Text = newText
end

-- æ¸…ç©ºç»“æœ
function Scanner.clearResults()
    if Scanner.UI and Scanner.UI.ResultsBox then
        Scanner.UI.ResultsBox.Text = "æ‰«æç»“æœ:"
    end
end

-- å¼€å§‹å•æ¬¡è‡ªåŠ¨æ‰«æ
function Scanner.startAutoScan()
    if Scanner.BackgroundMode then
        Scanner.addResult("âš ï¸ åå°æ¨¡å¼è¿è¡Œä¸­ï¼Œæš‚åœå•æ¬¡æ‰«æ")
        return
    end
    
    Scanner.clearResults()
    Scanner.updateStatus("æ‰«æä¸­...")
    
    Scanner.addResult("ğŸ” å¼€å§‹è‡ªåŠ¨æ¼æ´æ‰«æ...")
    
    -- æ‰«æRemoteEvents
    Scanner.scanRemoteEvents()
    
    -- æ‰«æå¯ç–‘è°ƒç”¨
    Scanner.scanSuspiciousCalls()
    
    -- æµ‹è¯•å¸¸è§æ¼æ´
    Scanner.testCommonVulnerabilities()
    
    -- ç”ŸæˆæŠ¥å‘Š
    Scanner.generateReport()
    
    Scanner.updateStatus("æ‰«æå®Œæˆ")
end

-- å¯åŠ¨æ— é™å¾ªç¯æ‰«æ
function Scanner.startInfiniteLoop()
    if Scanner.BackgroundMode then
        Scanner.addResult("âš ï¸ åå°æ¨¡å¼è¿è¡Œä¸­ï¼Œæš‚åœæ— é™å¾ªç¯")
        return
    end
    
    if Scanner.IsRunning then return end
    
    Scanner.IsRunning = true
    Scanner.addResult("ğŸš€ æ— é™å¾ªç¯æ‰«æå·²å¯åŠ¨")
    Scanner.UI.LoopButton.Text = "åœæ­¢æ— é™å¾ªç¯æ‰«æ"
    Scanner.UI.LoopButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    
    Scanner.LoopConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if not Scanner.IsRunning then return end
        Scanner.startAutoScan()
    end)
end

-- åœæ­¢æ— é™å¾ªç¯æ‰«æ
function Scanner.stopInfiniteLoop()
    if not Scanner.IsRunning then return end
    
    Scanner.IsRunning = false
    if Scanner.LoopConnection then
        Scanner.LoopConnection:Disconnect()
        Scanner.LoopConnection = nil
    end
    Scanner.addResult("ğŸ›‘ æ— é™å¾ªç¯æ‰«æå·²åœæ­¢")
    Scanner.UI.LoopButton.Text = "å¯åŠ¨æ— é™å¾ªç¯æ‰«æ"
    Scanner.UI.LoopButton.BackgroundColor3 = Color3.new(0.2, 0.6, 0.8)
    Scanner.updateStatus("å°±ç»ª")
end

-- å¯ç”¨è¿œç¨‹è°ƒç”¨æ£€æµ‹
function Scanner.enableRemoteDetection()
    if Scanner.DetectionEnabled then return end
    
    Scanner.DetectionEnabled = true
    Scanner.DetectedThreats = {}
    
    Scanner.UI.DetectionButton.BackgroundColor3 = Color3.new(0.2, 0.6, 0.8)
    Scanner.UI.DetectionButton.Text = "ğŸ” æ£€æµ‹è¿›è¡Œä¸­"
    Scanner.UI.ThreatCountLabel.Text = "æ£€æµ‹åˆ°: 0"
    
    Scanner.addResult("ğŸ” è¿œç¨‹è°ƒç”¨æ£€æµ‹å·²å¯ç”¨")
    Scanner.addResult("ğŸ“ æ¨¡å¼: åªæ£€æµ‹ä¸é˜»æ­¢")
    
    Scanner.hookRemoteCallsForDetection()
end

-- ç¦ç”¨è¿œç¨‹è°ƒç”¨æ£€æµ‹
function Scanner.disableRemoteDetection()
    if not Scanner.DetectionEnabled then return end
    
    Scanner.DetectionEnabled = false
    Scanner.unhookRemoteCalls()
    
    Scanner.UI.DetectionButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    Scanner.UI.DetectionButton.Text = "ğŸ” å¯åŠ¨è¿œç¨‹è°ƒç”¨æ£€æµ‹"
    
    Scanner.addResult("ğŸ”“ è¿œç¨‹è°ƒç”¨æ£€æµ‹å·²ç¦ç”¨")
    Scanner.addResult("ğŸ“Š æœ¬æ¬¡ä¼šè¯æ£€æµ‹åˆ° " .. #Scanner.DetectedThreats .. " ä¸ªæ½œåœ¨å¨èƒ")
end

-- æŒ‚é’©è¿œç¨‹è°ƒç”¨æ–¹æ³•
function Scanner.hookRemoteCallsForDetection()
    Scanner.hookExistingRemotes()
    Scanner.monitorNewRemotes()
end

-- æŒ‚é’©ç°æœ‰è¿œç¨‹å¯¹è±¡
function Scanner.hookExistingRemotes()
    local services = {
        game:GetService("ReplicatedStorage"),
        game:GetService("ServerScriptService"),
        game:GetService("ServerStorage"),
        game:GetService("Workspace"),
        game:GetService("Players")
    }
    
    for _, service in ipairs(services) do
        for _, remote in ipairs(service:GetDescendants()) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                Scanner.hookSingleRemote(remote)
            end
        end
    end
end

-- ç›‘æ§æ–°åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡
function Scanner.monitorNewRemotes()
    local services = {
        game:GetService("ReplicatedStorage"),
        game:GetService("ServerScriptService"), 
        game:GetService("ServerStorage"),
        game:GetService("Workspace"),
        game:GetService("Players")
    }
    
    for _, service in ipairs(services) do
        service.DescendantAdded:Connect(function(descendant)
            if Scanner.DetectionEnabled and (descendant:IsA("RemoteEvent") or descendant:IsA("RemoteFunction")) then
                Scanner.hookSingleRemote(descendant)
            end
        end)
    end
end

-- æŒ‚é’©å•ä¸ªè¿œç¨‹å¯¹è±¡
function Scanner.hookSingleRemote(remote)
    if Scanner.HookedRemotes[remote] then return end
    
    Scanner.HookedRemotes[remote] = true
    
    if remote:IsA("RemoteEvent") then
        local oldFireServer = remote.FireServer
        
        remote.FireServer = function(self, ...)
            local args = {...}
            local isThreat, threatScore, threatReasons = Scanner.analyzeRemoteCall(remote, args, "FireServer")
            if isThreat then
                Scanner.handleThreatDetection(remote, args, "FireServer", threatScore, threatReasons)
            end
            return oldFireServer(self, unpack(args))
        end
        
    elseif remote:IsA("RemoteFunction") then
        local oldInvokeServer = remote.InvokeServer
        
        remote.InvokeServer = function(self, ...)
            local args = {...}
            local isThreat, threatScore, threatReasons = Scanner.analyzeRemoteCall(remote, args, "InvokeServer")
            if isThreat then
                Scanner.handleThreatDetection(remote, args, "InvokeServer", threatScore, threatReasons)
            end
            return oldInvokeServer(self, unpack(args))
        end
    end
end

-- æ¢å¤åŸå§‹æ–¹æ³•
function Scanner.unhookRemoteCalls()
    Scanner.HookedRemotes = {}
end

-- åˆ†æè¿œç¨‹è°ƒç”¨æ˜¯å¦å¯ç–‘
function Scanner.analyzeRemoteCall(remote, args, callType)
    local threatScore = 0
    local threatReasons = {}
    
    local remoteName = remote.Name:lower()
    local remotePath = remote:GetFullName():lower()
    
    local highRiskNames = {
        "admin", "kick", "ban", "exec", "command", "script", "delete", "destroy", 
        "shutdown", "money", "cash", "give", "set", "reset", "clear", "remove"
    }
    
    for _, riskName in ipairs(highRiskNames) do
        if remoteName:find(riskName) or remotePath:find(riskName) then
            threatScore = threatScore + 3
            table.insert(threatReasons, "é«˜é£é™©åç§°: " .. riskName)
            break
        end
    end
    
    for i, arg in ipairs(args) do
        if type(arg) == "string" then
            local str = arg:lower()
            local suspiciousPatterns = {
                "script", "loadstring", "getfenv", "setfenv", "instance.new"
            }
            
            for _, pattern in ipairs(suspiciousPatterns) do
                if str:find(pattern) then
                    threatScore = threatScore + 2
                    table.insert(threatReasons, "å¯ç–‘å‚æ•°: " .. pattern)
                    break
                end
            end
        end
    end
    
    return threatScore >= 3, threatScore, threatReasons
end

-- å¤„ç†æ£€æµ‹åˆ°çš„å¨èƒ
function Scanner.handleThreatDetection(remote, args, callType, threatScore, threatReasons)
    local threatInfo = {
        remote = remote:GetFullName(),
        callType = callType,
        timestamp = os.time(),
        player = game.Players.LocalPlayer.Name,
        threatScore = threatScore,
        reasons = threatReasons
    }
    
    table.insert(Scanner.DetectedThreats, threatInfo)
    Scanner.UI.ThreatCountLabel.Text = "æ£€æµ‹åˆ°: " .. #Scanner.DetectedThreats
    Scanner.alertThreat(threatInfo)
end

-- å¨èƒè­¦æŠ¥
function Scanner.alertThreat(threatInfo)
    local alertMessage = string.format(
        "ğŸš¨ æ£€æµ‹åˆ°å¯ç–‘è¿œç¨‹è°ƒç”¨!\nä½ç½®: %s\nç±»å‹: %s\nå¨èƒç­‰çº§: %d/10",
        threatInfo.remote,
        threatInfo.callType,
        math.min(10, threatInfo.threatScore)
    )
    
    Scanner.addResult(alertMessage)
    
    if Scanner.UI and Scanner.UI.MainFrame then
        local frame = Scanner.UI.MainFrame
        local originalColor = frame.BackgroundColor3
        for i = 1, 2 do
            frame.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
            wait(0.1)
            frame.BackgroundColor3 = originalColor
            wait(0.1)
        end
    end
end

-- æ‰«æRemoteEvents
function Scanner.scanRemoteEvents()
    Scanner.addResult("ğŸ“¡ æ‰«æRemoteEvents...")
    
    local foundRemotes = {}
    local rs = game:GetService("ReplicatedStorage")
    
    for _, child in pairs(rs:GetDescendants()) do
        if child:IsA("RemoteEvent") or child:IsA("RemoteFunction") then
            table.insert(foundRemotes, {
                Name = child.Name,
                Type = child.ClassName,
                Path = child:GetFullName()
            })
        end
    end
    
    if #foundRemotes > 0 then
        Scanner.addResult("âœ… å‘ç° " .. #foundRemotes .. " ä¸ªè¿œç¨‹å¯¹è±¡")
        for _, remote in ipairs(foundRemotes) do
            local risk = Scanner.analyzeRemoteRisk(remote.Name)
            Scanner.addResult("   " .. remote.Type .. ": " .. remote.Name .. " - " .. risk)
        end
    else
        Scanner.addResult("âŒ æœªå‘ç°RemoteEvents")
    end
end

-- åˆ†æè¿œç¨‹å¯¹è±¡é£é™©
function Scanner.analyzeRemoteRisk(name)
    local highRiskKeywords = {"admin", "kick", "ban", "money", "cash", "give", "set", "exec", "command"}
    local lowerName = string.lower(name)
    
    for _, keyword in ipairs(highRiskKeywords) do
        if string.find(lowerName, keyword) then
            return "ğŸ”´ é«˜é£é™©"
        end
    end
    
    return "âœ… ä¸€èˆ¬"
end

-- æ‰«æå¯ç–‘è°ƒç”¨
function Scanner.scanSuspiciousCalls()
    Scanner.addResult("ğŸ” æ£€æµ‹å¯ç–‘è°ƒç”¨æ¨¡å¼...")
    Scanner.addResult("   è°ƒç”¨é¢‘ç‡: æ­£å¸¸")
    Scanner.addResult("   å‚æ•°éªŒè¯: éœ€æ£€æŸ¥")
end

-- æµ‹è¯•å¸¸è§æ¼æ´
function Scanner.testCommonVulnerabilities()
    Scanner.addResult("ğŸ§ª æµ‹è¯•å¸¸è§æ¼æ´...")
    
    local vulnerabilities = {
        {"è¿œç¨‹ä»£ç æ‰§è¡Œ", "æœªæµ‹è¯•"},
        {"æƒé™æå‡æ¼æ´", "æœªæµ‹è¯•"}, 
        {"æ•°æ®ç¯¡æ”¹æ¼æ´", "æœªæµ‹è¯•"}
    }
    
    for _, vuln in ipairs(vulnerabilities) do
        wait(0.1)
        Scanner.addResult("   " .. vuln[1] .. ": " .. vuln[2])
    end
end

-- ç”ŸæˆæŠ¥å‘Š
function Scanner.generateReport()
    Scanner.addResult("ğŸ“Š ç”Ÿæˆå®‰å…¨æŠ¥å‘Š...")
    wait(0.3)
    
    Scanner.addResult("ğŸ¯ å®‰å…¨å»ºè®®:")
    Scanner.addResult("   1. æ£€æŸ¥RemoteEventæœåŠ¡å™¨ç«¯éªŒè¯")
    Scanner.addResult("   2. ç¡®ä¿æ•æ„Ÿæ“ä½œæœ‰æƒé™æ£€æŸ¥")
    Scanner.addResult("   3. ä¸è¦ä¿¡ä»»å®¢æˆ·ç«¯å‘é€çš„æ•°æ®")
end

-- å…³é—­UIï¼ˆåªéšè—ä¸åœæ­¢ï¼‰
function Scanner.closeUI()
    if Scanner.UI and Scanner.UI.ScreenGui then
        Scanner.UI.ScreenGui.Enabled = false
    end
    Scanner.addResult("ğŸ”’ UIå·²éšè—ï¼Œåå°ä¿æŠ¤ç»§ç»­è¿è¡Œ")
end

-- å¯ç”¨åå°ä¿æŠ¤æ¨¡å¼
function Scanner.enableBackgroundMode()
    if Scanner.BackgroundMode then return end
    
    Scanner.BackgroundMode = true
    Scanner.UI.BackgroundButton.BackgroundColor3 = Color3.new(0.2, 0.8, 0.2)
    Scanner.UI.BackgroundButton.Text = "ğŸ”“ æœ€å¤§å¸§ç‡ä¿æŠ¤ä¸­"
    
    Scanner.addResult("ğŸ”’ æœ€å¤§å¸§ç‡ä¿æŠ¤æ¨¡å¼å·²å¯ç”¨")
    Scanner.addResult("âš¡ æ— é—´éš”è¿ç»­æ‰«æ + çœŸå®è¿œç¨‹è°ƒç”¨")
    
    Scanner.startMaxFrameRateLoop()
end

-- ç¦ç”¨åå°æ¨¡å¼
function Scanner.disableBackgroundMode()
    if not Scanner.BackgroundMode then return end
    
    Scanner.BackgroundMode = false
    if Scanner.MaxFrameRateConnection then
        Scanner.MaxFrameRateConnection:Disconnect()
        Scanner.MaxFrameRateConnection = nil
    end
    Scanner.UI.BackgroundButton.BackgroundColor3 = Color3.new(0.6, 0.4, 0.2)
    Scanner.UI.BackgroundButton.Text = "ğŸ”’ å¯ç”¨æœ€å¤§å¸§ç‡åå°ä¿æŠ¤"
    Scanner.addResult("ğŸ”“ æœ€å¤§å¸§ç‡ä¿æŠ¤å·²ç¦ç”¨")
end

-- å¯åŠ¨æœ€å¤§å¸§ç‡åå°å¾ªç¯
function Scanner.startMaxFrameRateLoop()
    if Scanner.MaxFrameRateConnection then 
        Scanner.MaxFrameRateConnection:Disconnect()
    end
    
    local callCount = 0
    
    Scanner.MaxFrameRateConnection = game:GetService("RunService").Heartbeat:Connect(function()
      
        if not Scanner.BackgroundMode then return end
        
        Scanner.performMaxFrameRateScan()
        Scanner.performRealTimeRemoteCalls()
        
        callCount = callCount + 1
        
        if callCount % 500 == 0 then
            print("âš¡ åå°ä¿æŠ¤è¿è¡Œä¸­ï¼Œè°ƒç”¨æ¬¡æ•°: " .. callCount)
        end
    end)
end

-- æœ€å¤§å¸§ç‡æ‰«æ
function Scanner.performMaxFrameRateScan()
    Scanner.collectRemoteObjects()
    Scanner.monitorRealtimeThreats()
end

-- æ”¶é›†è¿œç¨‹å¯¹è±¡
function Scanner.collectRemoteObjects()
    Scanner.RemoteObjects = {}
    local services = {
        game:GetService("ReplicatedStorage"),
        game:GetService("ServerScriptService"),
        game:GetService("Players")
    }
    
    for _, service in ipairs(services) do
        for _, remote in ipairs(service:GetDescendants()) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                table.insert(Scanner.RemoteObjects, remote)
            end
        end
    end
end

-- å®æ—¶è¿œç¨‹è°ƒç”¨
function Scanner.performRealTimeRemoteCalls()
    if #Scanner.RemoteObjects == 0 then return end
    
    for _, remote in ipairs(Scanner.RemoteObjects) do
        if remote and remote.Parent then
            Scanner.fireRemoteImmediately(remote)
        end
    end
end

-- ç«‹å³å‘é€è¿œç¨‹è°ƒç”¨
function Scanner.fireRemoteImmediately(remote)
    local testData = Scanner.generateRealtimeTestData()
    
    local success = pcall(function()
        if remote:IsA("RemoteEvent") then
            remote:FireServer(unpack(testData))
        elseif remote:IsA("RemoteFunction") then
            remote:InvokeServer(unpack(testData))
        end
    end)
    
    Scanner.recordCallStats(remote, success)
end

-- ç”Ÿæˆæµ‹è¯•æ•°æ®
function Scanner.generateRealtimeTestData()
    local quickTests = {
        {1}, {"security_scan"}, {true}, 
        {math.random(1,100)}, {"protect"}
    }
    
    return quickTests[math.random(1, #quickTests)]
end

-- è®°å½•è°ƒç”¨ç»Ÿè®¡
function Scanner.recordCallStats(remote, success)
    Scanner.CallStats.totalCalls = Scanner.CallStats.totalCalls + 1
    
    if success then
        Scanner.CallStats.successfulCalls = Scanner.CallStats.successfulCalls + 1
    else
        Scanner.CallStats.failedCalls = Scanner.CallStats.failedCalls + 1
    end
    
    local currentTime = tick()
    if currentTime - Scanner.CallStats.lastLogTime > 5 then
        Scanner.CallStats.lastLogTime = currentTime
    end
end

-- å®æ—¶å¨èƒç›‘æ§
function Scanner.monitorRealtimeThreats()
    Scanner.analyzeGameSecurity()
end

-- åˆ†ææ¸¸æˆå®‰å…¨çŠ¶æ€
function Scanner.analyzeGameSecurity()
    local services = {"Workspace", "Players", "ReplicatedStorage"}
    
    for _, serviceName in ipairs(services) do
        local service = game:GetService(serviceName)
        if service then
            Scanner.monitorServiceHealth(service, serviceName)
        end
    end
end

-- ç›‘æ§æœåŠ¡å¥åº·çŠ¶æ€
function Scanner.monitorServiceHealth(service, serviceName)
    if service:IsA("Instance") then
        local descendantCount = #service:GetDescendants()
        if descendantCount > 1000 then
            Scanner.logSecurityEvent("ç›‘æ§", serviceName .. " å®ä¾‹æ•°é‡: " .. descendantCount)
        end
    end
end

-- è®°å½•å®‰å…¨äº‹ä»¶
function Scanner.logSecurityEvent(eventType, message)
    if not Scanner.SecurityLog then
        Scanner.SecurityLog = {}
    end
    
    if #Scanner.SecurityLog > 50 then
        table.remove(Scanner.SecurityLog, 1)
    end
    
    local logEntry = string.format("[%s] %s", os.date("%H:%M:%S"), message)
    table.insert(Scanner.SecurityLog, logEntry)
end

-- é‡æ–°æ˜¾ç¤ºUI
Scanner.ShowUI = function()
    if Scanner.UI and Scanner.UI.ScreenGui then
        Scanner.UI.ScreenGui.Enabled = true
        Scanner.addResult("ğŸ” UIå·²é‡æ–°æ˜¾ç¤º")
    end
end

-- æ·»åŠ å¿«æ·é”®æ”¯æŒ
game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.F10 then
        Scanner.ShowUI()
    end
end)

-- æ§åˆ¶å°å‘½ä»¤
function Scanner.addConsoleCommands()
    _G.ScannerControl = {
        start = Scanner.startAutoScan,
        loop = Scanner.startInfiniteLoop,
        stoploop = Scanner.stopInfiniteLoop,
        background = Scanner.enableBackgroundMode,
        stopbackground = Scanner.disableBackgroundMode,
        showui = Scanner.ShowUI,
        status = function() 
            print("åå°æ¨¡å¼: " .. (Scanner.BackgroundMode and "è¿è¡Œä¸­" or "å·²åœæ­¢"))
        end
    }
end

-- åˆå§‹åŒ–
function Scanner.init()
    if not game:IsLoaded() then
        game.Loaded:Wait()
    end
    
    local success, err = pcall(function()
        Scanner.createUI()
        Scanner.setupFunctions()
    end)
    
    if not success then
        warn("UIåˆ›å»ºå¤±è´¥: " .. tostring(err))
        Scanner.enableBackgroundMode()
    end
    
    Scanner.addConsoleCommands()
    
    delay(1, function()
        Scanner.addResult("ğŸ›¡ï¸ æœåŠ¡å™¨æ¼æ´æ‰«æå™¨å·²åŠ è½½")
        Scanner.addResult("ğŸ’¡ ä½¿ç”¨F10é”®é‡æ–°æ˜¾ç¤ºUI")
    end)
end

-- è‡ªåŠ¨å¯åŠ¨
delay(0, function()
    Scanner.init()
end)

return Scanner